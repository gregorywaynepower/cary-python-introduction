<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Cary Introduction to Python - Handling duplicate, missing, or invalid data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Cary Introduction to Python</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notebooks/handling_data_issues.html">Handling duplicate, missing, or invalid data</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/introduction_to_data_analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Data Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/hypothesis_testing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hypothesis Testing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/python_101.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python 101</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/python_errors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python Errors</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/reading_local_files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">An Introduction to Jupyter Notebooks</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/making_dataframes_from_api_requests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Making Pandas DataFrames from API Requests</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/wide_vs_long.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wide vs.&nbsp;Long Format Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/cleaning_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cleaning Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/handling_data_issues.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Handling duplicate, missing, or invalid data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/intro_to_plotly_express.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Animations in Plotly Express</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/introducing_matplotlib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started with Matplotlib</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/plotting_with_pandas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Plotting with Pandas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/pandas_plotting_module.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The <code>pandas.plotting</code> module</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#handling-duplicate-missing-or-invalid-data" id="toc-handling-duplicate-missing-or-invalid-data" class="nav-link active" data-scroll-target="#handling-duplicate-missing-or-invalid-data">Handling duplicate, missing, or invalid data</a>
  <ul class="collapse">
  <li><a href="#about-the-data" id="toc-about-the-data" class="nav-link" data-scroll-target="#about-the-data">About the data</a></li>
  <li><a href="#background-on-the-data" id="toc-background-on-the-data" class="nav-link" data-scroll-target="#background-on-the-data">Background on the data</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#finding-problematic-data" id="toc-finding-problematic-data" class="nav-link" data-scroll-target="#finding-problematic-data">Finding problematic data</a></li>
  <li><a href="#mitigating-issues" id="toc-mitigating-issues" class="nav-link" data-scroll-target="#mitigating-issues">Mitigating Issues</a>
  <ul class="collapse">
  <li><a href="#handling-duplicated-data" id="toc-handling-duplicated-data" class="nav-link" data-scroll-target="#handling-duplicated-data">Handling duplicated data</a></li>
  <li><a href="#dealing-with-nulls" id="toc-dealing-with-nulls" class="nav-link" data-scroll-target="#dealing-with-nulls">Dealing with nulls</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Handling duplicate, missing, or invalid data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="handling-duplicate-missing-or-invalid-data" class="level1">
<h1>Handling duplicate, missing, or invalid data</h1>
<section id="about-the-data" class="level2">
<h2 class="anchored" data-anchor-id="about-the-data">About the data</h2>
<p>In this notebook, we will using daily weather data that was taken from the <a href="https://www.ncdc.noaa.gov/cdo-web/webservices/v2">National Centers for Environmental Information (NCEI) API</a> and altered to introduce many common problems faced when working with data.</p>
<p><em>Note: The NCEI is part of the National Oceanic and Atmospheric Administration (NOAA) and, as you can see from the URL for the API, this resource was created when the NCEI was called the NCDC. Should the URL for this resource change in the future, you can search for “NCEI weather API” to find the updated one.</em></p>
</section>
<section id="background-on-the-data" class="level2">
<h2 class="anchored" data-anchor-id="background-on-the-data">Background on the data</h2>
<p>Data meanings: - <code>PRCP</code>: precipitation in millimeters - <code>SNOW</code>: snowfall in millimeters - <code>SNWD</code>: snow depth in millimeters - <code>TMAX</code>: maximum daily temperature in Celsius - <code>TMIN</code>: minimum daily temperature in Celsius - <code>TOBS</code>: temperature at time of observation in Celsius - <code>WESF</code>: water equivalent of snow in millimeters</p>
<p>Some important facts to get our bearings: - According to the National Weather Service, the coldest temperature ever recorded in Central Park was -15°F (-26.1°C) on February 9, 1934: <a href="https://www.weather.gov/media/okx/Climate/CentralPark/extremes.pdf">source</a> - The temperature of the Sun’s photosphere is approximately 5,505°C: <a href="https://en.wikipedia.org/wiki/Sun">source</a></p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>We need to import <code>pandas</code> and read in the dirty data to get started:</p>
<div id="cell-1" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">'../data/dirty_data.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="finding-problematic-data" class="level2">
<h2 class="anchored" data-anchor-id="finding-problematic-data">Finding problematic data</h2>
<p>A good first step is to look at some rows:</p>
<div id="cell-3" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">station</th>
<th data-quarto-table-cell-role="th">PRCP</th>
<th data-quarto-table-cell-role="th">SNOW</th>
<th data-quarto-table-cell-role="th">SNWD</th>
<th data-quarto-table-cell-role="th">TMAX</th>
<th data-quarto-table-cell-role="th">TMIN</th>
<th data-quarto-table-cell-role="th">TOBS</th>
<th data-quarto-table-cell-role="th">WESF</th>
<th data-quarto-table-cell-role="th">inclement_weather</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2018-01-01T00:00:00</td>
<td>?</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2018-01-01T00:00:00</td>
<td>?</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2018-01-01T00:00:00</td>
<td>?</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2018-01-02T00:00:00</td>
<td>GHCND:USC00280907</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-8.3</td>
<td>-16.1</td>
<td>-12.2</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2018-01-03T00:00:00</td>
<td>GHCND:USC00280907</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.3</td>
<td>NaN</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Looking at summary statistics can reveal strange or missing values:</p>
<div id="cell-5" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\gpower\AppData\Local\mambaforge\envs\cary_dev\Lib\site-packages\numpy\lib\function_base.py:4573: RuntimeWarning: invalid value encountered in subtract
  diff_b_a = subtract(b, a)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PRCP</th>
<th data-quarto-table-cell-role="th">SNOW</th>
<th data-quarto-table-cell-role="th">SNWD</th>
<th data-quarto-table-cell-role="th">TMAX</th>
<th data-quarto-table-cell-role="th">TMIN</th>
<th data-quarto-table-cell-role="th">TOBS</th>
<th data-quarto-table-cell-role="th">WESF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>765.000000</td>
<td>577.000000</td>
<td>577.0</td>
<td>765.000000</td>
<td>765.000000</td>
<td>398.000000</td>
<td>11.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>5.360392</td>
<td>4.202773</td>
<td>NaN</td>
<td>2649.175294</td>
<td>-15.914379</td>
<td>8.632161</td>
<td>16.290909</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>10.002138</td>
<td>25.086077</td>
<td>NaN</td>
<td>2744.156281</td>
<td>24.242849</td>
<td>9.815054</td>
<td>9.489832</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000000</td>
<td>0.000000</td>
<td>-inf</td>
<td>-11.700000</td>
<td>-40.000000</td>
<td>-16.100000</td>
<td>1.800000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.000000</td>
<td>0.000000</td>
<td>NaN</td>
<td>13.300000</td>
<td>-40.000000</td>
<td>0.150000</td>
<td>8.600000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>0.000000</td>
<td>0.000000</td>
<td>NaN</td>
<td>32.800000</td>
<td>-11.100000</td>
<td>8.300000</td>
<td>19.300000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>5.800000</td>
<td>0.000000</td>
<td>NaN</td>
<td>5505.000000</td>
<td>6.700000</td>
<td>18.300000</td>
<td>24.900000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>61.700000</td>
<td>229.000000</td>
<td>inf</td>
<td>5505.000000</td>
<td>23.900000</td>
<td>26.100000</td>
<td>28.700000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The <code>info()</code> method can pinpoint missing values and wrong data types:</p>
<div id="cell-7" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 765 entries, 0 to 764
Data columns (total 10 columns):
 #   Column             Non-Null Count  Dtype  
---  ------             --------------  -----  
 0   date               765 non-null    object 
 1   station            765 non-null    object 
 2   PRCP               765 non-null    float64
 3   SNOW               577 non-null    float64
 4   SNWD               577 non-null    float64
 5   TMAX               765 non-null    float64
 6   TMIN               765 non-null    float64
 7   TOBS               398 non-null    float64
 8   WESF               11 non-null     float64
 9   inclement_weather  408 non-null    object 
dtypes: float64(7), object(3)
memory usage: 59.9+ KB</code></pre>
</div>
</div>
<p>We can use the <code>isna()</code>/<code>isnull()</code> method of the series to find nulls:</p>
<div id="cell-9" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>contain_nulls <span class="op">=</span> df[</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    df.SNOW.isna() <span class="op">|</span> df.SNWD.isna() <span class="op">|</span> df.TOBS.isna()</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> df.WESF.isna() <span class="op">|</span> df.inclement_weather.isna()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>contain_nulls.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>765</code></pre>
</div>
</div>
<div id="cell-10" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>contain_nulls.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">station</th>
<th data-quarto-table-cell-role="th">PRCP</th>
<th data-quarto-table-cell-role="th">SNOW</th>
<th data-quarto-table-cell-role="th">SNWD</th>
<th data-quarto-table-cell-role="th">TMAX</th>
<th data-quarto-table-cell-role="th">TMIN</th>
<th data-quarto-table-cell-role="th">TOBS</th>
<th data-quarto-table-cell-role="th">WESF</th>
<th data-quarto-table-cell-role="th">inclement_weather</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2018-01-01T00:00:00</td>
<td>?</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2018-01-01T00:00:00</td>
<td>?</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2018-01-01T00:00:00</td>
<td>?</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2018-01-02T00:00:00</td>
<td>GHCND:USC00280907</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-8.3</td>
<td>-16.1</td>
<td>-12.2</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2018-01-03T00:00:00</td>
<td>GHCND:USC00280907</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.3</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2018-01-03T00:00:00</td>
<td>GHCND:USC00280907</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.3</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>2018-01-03T00:00:00</td>
<td>GHCND:USC00280907</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.3</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>2018-01-04T00:00:00</td>
<td>?</td>
<td>20.6</td>
<td>229.0</td>
<td>inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>19.3</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>2018-01-04T00:00:00</td>
<td>?</td>
<td>20.6</td>
<td>229.0</td>
<td>inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>19.3</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>2018-01-05T00:00:00</td>
<td>?</td>
<td>0.3</td>
<td>NaN</td>
<td>NaN</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Note that we can’t check if we have <code>NaN</code> like this:</p>
<div id="cell-12" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df[df.inclement_weather <span class="op">==</span> <span class="st">'NaN'</span>].shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>0</code></pre>
</div>
</div>
<p>This is because it is actually <code>np.nan</code>. However, notice this also doesn’t work:</p>
<div id="cell-14" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df[df.inclement_weather <span class="op">==</span> np.nan].shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>0</code></pre>
</div>
</div>
<p>We have to use one of the methods discussed earlier for this to work:</p>
<div id="cell-16" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df[df.inclement_weather.isna()].shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>357</code></pre>
</div>
</div>
<p>We can find <code>-inf</code>/<code>inf</code> by comparing to <code>-np.inf</code>/<code>np.inf</code>:</p>
<div id="cell-18" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df[df.SNWD.isin([<span class="op">-</span>np.inf, np.inf])].shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>577</code></pre>
</div>
</div>
<p>Rather than do this for each column, we can write a function that will use a <a href="https://www.python.org/dev/peps/pep-0274/">dictionary comprehension</a> to check all the columns for us:</p>
<div id="cell-20" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_inf_count(df):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Find the number of inf/-inf values per column in the dataframe"""</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        col: df[df[col].isin([np.inf, <span class="op">-</span>np.inf])].shape[<span class="dv">0</span>] <span class="cf">for</span> col <span class="kw">in</span> df.columns</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>get_inf_count(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>{'date': 0,
 'station': 0,
 'PRCP': 0,
 'SNOW': 0,
 'SNWD': 577,
 'TMAX': 0,
 'TMIN': 0,
 'TOBS': 0,
 'WESF': 0,
 'inclement_weather': 0}</code></pre>
</div>
</div>
<p>Before we can decide how to handle the infinite values of snow depth, we should look at the summary statistics for snowfall, which forms a big part in determining the snow depth:</p>
<div id="cell-22" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'np.inf Snow Depth'</span>: df[df.SNWD <span class="op">==</span> np.inf].SNOW.describe(),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'-np.inf Snow Depth'</span>: df[df.SNWD <span class="op">==</span> <span class="op">-</span>np.inf].SNOW.describe()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>}).T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">np.inf Snow Depth</td>
<td>24.0</td>
<td>101.041667</td>
<td>74.498018</td>
<td>13.0</td>
<td>25.0</td>
<td>120.5</td>
<td>152.0</td>
<td>229.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">-np.inf Snow Depth</td>
<td>553.0</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Let’s now look into the <code>date</code> and <code>station</code> columns. We saw the <code>?</code> for station earlier, so we know that was the other unique value. However, we see that some dates are present 8 times in the data and we only have 324 days meaning we are also missing days:</p>
<div id="cell-24" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>df.describe(include<span class="op">=</span><span class="st">'object'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">station</th>
<th data-quarto-table-cell-role="th">inclement_weather</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>765</td>
<td>765</td>
<td>408</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">unique</td>
<td>324</td>
<td>2</td>
<td>2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">top</td>
<td>2018-07-05T00:00:00</td>
<td>GHCND:USC00280907</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">freq</td>
<td>8</td>
<td>398</td>
<td>384</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can use the <code>duplicated()</code> method to find duplicate rows:</p>
<div id="cell-26" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df[df.duplicated()].shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>284</code></pre>
</div>
</div>
<p>The default for <code>keep</code> is <code>'first'</code> meaning it won’t show the first row that the duplicated data was seen in; we can pass in <code>False</code> to see it though:</p>
<div id="cell-28" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df[df.duplicated(keep<span class="op">=</span><span class="va">False</span>)].shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>482</code></pre>
</div>
</div>
<p>We can also specify the columns to use:</p>
<div id="cell-30" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df[df.duplicated([<span class="st">'date'</span>, <span class="st">'station'</span>])].shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>284</code></pre>
</div>
</div>
<p>Let’s look at a few duplicates. Just in the few values we see here, we know that the top 4 are actually in the data 6 times because by default we aren’t seeing their first occurrence:</p>
<div id="cell-32" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df[df.duplicated()].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">station</th>
<th data-quarto-table-cell-role="th">PRCP</th>
<th data-quarto-table-cell-role="th">SNOW</th>
<th data-quarto-table-cell-role="th">SNWD</th>
<th data-quarto-table-cell-role="th">TMAX</th>
<th data-quarto-table-cell-role="th">TMIN</th>
<th data-quarto-table-cell-role="th">TOBS</th>
<th data-quarto-table-cell-role="th">WESF</th>
<th data-quarto-table-cell-role="th">inclement_weather</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2018-01-01T00:00:00</td>
<td>?</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>2018-01-01T00:00:00</td>
<td>?</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>2018-01-03T00:00:00</td>
<td>GHCND:USC00280907</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.3</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6</td>
<td>2018-01-03T00:00:00</td>
<td>GHCND:USC00280907</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.3</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>2018-01-04T00:00:00</td>
<td>?</td>
<td>20.6</td>
<td>229.0</td>
<td>inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>19.3</td>
<td>True</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="mitigating-issues" class="level2">
<h2 class="anchored" data-anchor-id="mitigating-issues">Mitigating Issues</h2>
<section id="handling-duplicated-data" class="level3">
<h3 class="anchored" data-anchor-id="handling-duplicated-data">Handling duplicated data</h3>
<p>Since we know we have NY weather data and noticed we only had two entries for <code>station</code>, we may decide to drop the <code>station</code> column because we are only interested in the weather data. However, when dealing with duplicate data, we need to think of the ramifications of removing it. Notice we only have data for the <code>WESF</code> column when the station is <code>?</code>:</p>
<div id="cell-34" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df[df.WESF.notna()].station.unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>array(['?'], dtype=object)</code></pre>
</div>
</div>
<p>If we determine it won’t impact our analysis, we can use <code>drop_duplicates()</code> to remove them:</p>
<div id="cell-36" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. make the date a datetime</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df.date <span class="op">=</span> pd.to_datetime(df.date)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. save this information for later</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>station_qm_wesf <span class="op">=</span> df[df.station <span class="op">==</span> <span class="st">'?'</span>].drop_duplicates(<span class="st">'date'</span>).set_index(<span class="st">'date'</span>).WESF</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. sort ? to the bottom</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>df.sort_values(<span class="st">'station'</span>, ascending<span class="op">=</span><span class="va">False</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. drop duplicates based on the date column keeping the first occurrence </span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># which will be the valid station if it has data</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>df_deduped <span class="op">=</span> df.drop_duplicates(<span class="st">'date'</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. remove the station column because we are done with it</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>df_deduped <span class="op">=</span> df_deduped.drop(columns<span class="op">=</span><span class="st">'station'</span>).set_index(<span class="st">'date'</span>).sort_index()</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. take valid station's WESF and fall back on station ? if it is null</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>df_deduped <span class="op">=</span> df_deduped.assign(</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    WESF<span class="op">=</span><span class="kw">lambda</span> x: x.WESF.combine_first(station_qm_wesf)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>df_deduped.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>(324, 8)</code></pre>
</div>
</div>
<p>Here we used the <code>combine_first()</code> method to coalesce the values to the first non-null entry; this means that if we had data from both stations, we would first take the value provided by the named station and if (and only if) that station was null would we take the value from the station named <code>?</code>. The following table contains some examples of how this would play out:</p>
<table class="table">
<thead>
<tr class="header">
<th style="text-align: center;">station GHCND:USC00280907</th>
<th style="text-align: center;">station ?</th>
<th style="text-align: center;">result of <code>combine_first()</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;"><code>NaN</code></td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>NaN</code></td>
<td style="text-align: center;">17</td>
<td style="text-align: center;">17</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>NaN</code></td>
<td style="text-align: center;"><code>NaN</code></td>
<td style="text-align: center;"><code>NaN</code></td>
</tr>
</tbody>
</table>
<p>Check out the 4th row—we have <code>WESF</code> in the correct spot thanks to the index:</p>
<div id="cell-38" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_deduped.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PRCP</th>
<th data-quarto-table-cell-role="th">SNOW</th>
<th data-quarto-table-cell-role="th">SNWD</th>
<th data-quarto-table-cell-role="th">TMAX</th>
<th data-quarto-table-cell-role="th">TMIN</th>
<th data-quarto-table-cell-role="th">TOBS</th>
<th data-quarto-table-cell-role="th">WESF</th>
<th data-quarto-table-cell-role="th">inclement_weather</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-01</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-02</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-8.3</td>
<td>-16.1</td>
<td>-12.2</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-03</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.3</td>
<td>NaN</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-04</td>
<td>20.6</td>
<td>229.0</td>
<td>inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>19.3</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-05</td>
<td>14.2</td>
<td>127.0</td>
<td>inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.9</td>
<td>NaN</td>
<td>True</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="dealing-with-nulls" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-nulls">Dealing with nulls</h3>
<p>We could drop nulls, replace them with some arbitrary value, or impute them using the surrounding data. Each of these options may have ramifications, so we must choose wisely.</p>
<p>We can use <code>dropna()</code> to drop rows where any column has a null value. The default options leave us hardly any data:</p>
<div id="cell-40" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df_deduped.dropna().shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>(4, 8)</code></pre>
</div>
</div>
<p>If we pass <code>how='all'</code>, we can choose to only drop rows where everything is null, but this removes nothing:</p>
<div id="cell-42" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>df_deduped.dropna(how<span class="op">=</span><span class="st">'all'</span>).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>(324, 8)</code></pre>
</div>
</div>
<p>We can use just a subset of columns to determine what to drop with the <code>subset</code> argument:</p>
<div id="cell-44" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df_deduped.dropna(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'all'</span>, subset<span class="op">=</span>[<span class="st">'inclement_weather'</span>, <span class="st">'SNOW'</span>, <span class="st">'SNWD'</span>]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>(293, 8)</code></pre>
</div>
</div>
<p>This can also be performed along columns, and we can also require a certain number of null values before we drop the data:</p>
<div id="cell-46" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df_deduped.dropna(axis<span class="op">=</span><span class="st">'columns'</span>, thresh<span class="op">=</span>df_deduped.shape[<span class="dv">0</span>] <span class="op">*</span> <span class="fl">.75</span>).columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>Index(['PRCP', 'SNOW', 'SNWD', 'TMAX', 'TMIN', 'TOBS', 'inclement_weather'], dtype='object')</code></pre>
</div>
</div>
<p>We can choose to fill in the null values instead with <code>fillna()</code>:</p>
<div id="cell-48" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df_deduped.loc[:,<span class="st">'WESF'</span>].fillna(<span class="dv">0</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>df_deduped.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PRCP</th>
<th data-quarto-table-cell-role="th">SNOW</th>
<th data-quarto-table-cell-role="th">SNWD</th>
<th data-quarto-table-cell-role="th">TMAX</th>
<th data-quarto-table-cell-role="th">TMIN</th>
<th data-quarto-table-cell-role="th">TOBS</th>
<th data-quarto-table-cell-role="th">WESF</th>
<th data-quarto-table-cell-role="th">inclement_weather</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-01</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-02</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-8.3</td>
<td>-16.1</td>
<td>-12.2</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-03</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.3</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-04</td>
<td>20.6</td>
<td>229.0</td>
<td>inf</td>
<td>5505.0</td>
<td>-40.0</td>
<td>NaN</td>
<td>19.3</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-05</td>
<td>14.2</td>
<td>127.0</td>
<td>inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.9</td>
<td>0.0</td>
<td>True</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>At this point we have done everything we can without distorting the data. We know that we are missing dates, but if we reindex, we don’t know how to fill in the <code>NaN</code> data. With the weather data, we can’t assume because it snowed one day that it will snow the next or that the temperature will be the same. For this reason, note that the next few examples are just for illustrative purposes only—just because we can do something doesn’t mean we should.</p>
<p>That being said, let’s try to address some of remaining issues with the temperature data. We know that when <code>TMAX</code> is the temperature of the Sun, it must be because there was no measured value, so let’s replace it with <code>NaN</code>. We will also do so for <code>TMIN</code> which currently uses -40°C for its placeholder when we know that the coldest temperature ever recorded in NYC was -15°F (-26.1°C) on February 9, 1934:</p>
<div id="cell-50" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df_deduped <span class="op">=</span> df_deduped.assign(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    TMAX<span class="op">=</span><span class="kw">lambda</span> x: x.TMAX.replace(<span class="dv">5505</span>, np.nan),</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    TMIN<span class="op">=</span><span class="kw">lambda</span> x: x.TMIN.replace(<span class="op">-</span><span class="dv">40</span>, np.nan),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will also make an assumption that the temperature won’t change drastically day-to-day. Note that this is actually a big assumption, but it will allow us to understand how <code>fillna()</code> works when we provide a strategy through the <code>method</code> parameter. The <code>fillna()</code> method gives us 2 options for the <code>method</code> parameter: - <code>'ffill'</code> to forward-fill - <code>'bfill'</code> to back-fill</p>
<p><em>Note that <code>'nearest'</code> is missing because we are not reindexing.</em></p>
<p>Here, we will use <code>'ffill'</code> to show how this works:</p>
<div id="cell-52" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df_deduped.assign(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    TMAX<span class="op">=</span><span class="kw">lambda</span> x: x.TMAX.fillna(method<span class="op">=</span><span class="st">'ffill'</span>),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    TMIN<span class="op">=</span><span class="kw">lambda</span> x: x.TMIN.fillna(method<span class="op">=</span><span class="st">'ffill'</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PRCP</th>
<th data-quarto-table-cell-role="th">SNOW</th>
<th data-quarto-table-cell-role="th">SNWD</th>
<th data-quarto-table-cell-role="th">TMAX</th>
<th data-quarto-table-cell-role="th">TMIN</th>
<th data-quarto-table-cell-role="th">TOBS</th>
<th data-quarto-table-cell-role="th">WESF</th>
<th data-quarto-table-cell-role="th">inclement_weather</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-01</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-02</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-8.3</td>
<td>-16.1</td>
<td>-12.2</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-03</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.3</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-04</td>
<td>20.6</td>
<td>229.0</td>
<td>inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>NaN</td>
<td>19.3</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-05</td>
<td>14.2</td>
<td>127.0</td>
<td>inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.9</td>
<td>0.0</td>
<td>True</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can use <code>np.nan_to_num()</code> to turn <code>np.nan</code> into 0 and <code>-np.inf</code>/<code>np.inf</code> into large negative or positive finite numbers:</p>
<div id="cell-54" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df_deduped.assign(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    SNWD<span class="op">=</span><span class="kw">lambda</span> x: np.nan_to_num(x.SNWD)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PRCP</th>
<th data-quarto-table-cell-role="th">SNOW</th>
<th data-quarto-table-cell-role="th">SNWD</th>
<th data-quarto-table-cell-role="th">TMAX</th>
<th data-quarto-table-cell-role="th">TMIN</th>
<th data-quarto-table-cell-role="th">TOBS</th>
<th data-quarto-table-cell-role="th">WESF</th>
<th data-quarto-table-cell-role="th">inclement_weather</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-01</td>
<td>0.0</td>
<td>0.0</td>
<td>-1.797693e+308</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-02</td>
<td>0.0</td>
<td>0.0</td>
<td>-1.797693e+308</td>
<td>-8.3</td>
<td>-16.1</td>
<td>-12.2</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-03</td>
<td>0.0</td>
<td>0.0</td>
<td>-1.797693e+308</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.3</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-04</td>
<td>20.6</td>
<td>229.0</td>
<td>1.797693e+308</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>19.3</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-05</td>
<td>14.2</td>
<td>127.0</td>
<td>1.797693e+308</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.9</td>
<td>0.0</td>
<td>True</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Depending on the data we are working with, we can use the <code>clip()</code> method as an alternative to <code>np.nan_to_num()</code>. The <code>clip()</code> method makes it possible to cap values at a specific minimum and/or maximum threshold. Since <code>SNWD</code> can’t be negative, let’s use <code>clip()</code> to enforce a lower bound of zero. To show how the upper bound works, let’s use the value of <code>SNOW</code>:</p>
<div id="cell-56" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df_deduped.assign(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    SNWD<span class="op">=</span><span class="kw">lambda</span> x: x.SNWD.clip(<span class="dv">0</span>, x.SNOW)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PRCP</th>
<th data-quarto-table-cell-role="th">SNOW</th>
<th data-quarto-table-cell-role="th">SNWD</th>
<th data-quarto-table-cell-role="th">TMAX</th>
<th data-quarto-table-cell-role="th">TMIN</th>
<th data-quarto-table-cell-role="th">TOBS</th>
<th data-quarto-table-cell-role="th">WESF</th>
<th data-quarto-table-cell-role="th">inclement_weather</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-01</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-02</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-8.3</td>
<td>-16.1</td>
<td>-12.2</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-03</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.3</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-04</td>
<td>20.6</td>
<td>229.0</td>
<td>229.0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>19.3</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-05</td>
<td>14.2</td>
<td>127.0</td>
<td>127.0</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.9</td>
<td>0.0</td>
<td>True</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can couple <code>fillna()</code> with other types of calculations. Here we replace missing values of <code>TMAX</code> with the median of all <code>TMAX</code> values, <code>TMIN</code> with the median of all <code>TMIN</code> values, and <code>TOBS</code> to the average of the <code>TMAX</code> and <code>TMIN</code> values. Since we place <code>TOBS</code> last, we have access to the imputed values for <code>TMIN</code> and <code>TMAX</code> in the calculation:</p>
<div id="cell-58" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>df_deduped.assign(</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    TMAX<span class="op">=</span><span class="kw">lambda</span> x: x.TMAX.fillna(x.TMAX.median()),</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    TMIN<span class="op">=</span><span class="kw">lambda</span> x: x.TMIN.fillna(x.TMIN.median()),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># average of TMAX and TMIN</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    TOBS<span class="op">=</span><span class="kw">lambda</span> x: x.TOBS.fillna((x.TMAX <span class="op">+</span> x.TMIN) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PRCP</th>
<th data-quarto-table-cell-role="th">SNOW</th>
<th data-quarto-table-cell-role="th">SNWD</th>
<th data-quarto-table-cell-role="th">TMAX</th>
<th data-quarto-table-cell-role="th">TMIN</th>
<th data-quarto-table-cell-role="th">TOBS</th>
<th data-quarto-table-cell-role="th">WESF</th>
<th data-quarto-table-cell-role="th">inclement_weather</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-01</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>14.4</td>
<td>5.6</td>
<td>10.0</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-02</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-8.3</td>
<td>-16.1</td>
<td>-12.2</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-03</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.3</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-04</td>
<td>20.6</td>
<td>229.0</td>
<td>inf</td>
<td>14.4</td>
<td>5.6</td>
<td>10.0</td>
<td>19.3</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-05</td>
<td>14.2</td>
<td>127.0</td>
<td>inf</td>
<td>-4.4</td>
<td>-13.9</td>
<td>-13.9</td>
<td>0.0</td>
<td>True</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can also use <code>apply()</code> for running the same calculation across columns. For example, let’s fill all missing values with their rolling 7-day median of their values, setting the number of periods required for the calculation to 0 to ensure we don’t introduce more extra <code>NaN</code> values. Rolling calculations will be covered later on, so this is a preview:</p>
<div id="cell-60" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df_deduped.<span class="bu">apply</span>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rolling calculations will be covered later on, this is a rolling 7-day median</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># we set min_periods (# of periods required for calculation) to 0 so we always get a result </span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">lambda</span> x: x.fillna(x.rolling(<span class="dv">7</span>, min_periods<span class="op">=</span><span class="dv">0</span>).median())</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>).head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PRCP</th>
<th data-quarto-table-cell-role="th">SNOW</th>
<th data-quarto-table-cell-role="th">SNWD</th>
<th data-quarto-table-cell-role="th">TMAX</th>
<th data-quarto-table-cell-role="th">TMIN</th>
<th data-quarto-table-cell-role="th">TOBS</th>
<th data-quarto-table-cell-role="th">WESF</th>
<th data-quarto-table-cell-role="th">inclement_weather</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-01</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-02</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-8.30</td>
<td>-16.1</td>
<td>-12.20</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-03</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-4.40</td>
<td>-13.9</td>
<td>-13.30</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-04</td>
<td>20.6</td>
<td>229.0</td>
<td>inf</td>
<td>-6.35</td>
<td>-15.0</td>
<td>-12.75</td>
<td>19.3</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-05</td>
<td>14.2</td>
<td>127.0</td>
<td>inf</td>
<td>-4.40</td>
<td>-13.9</td>
<td>-13.90</td>
<td>0.0</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-06</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-10.00</td>
<td>-15.6</td>
<td>-15.00</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-07</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-11.70</td>
<td>-17.2</td>
<td>-16.10</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-08</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-7.80</td>
<td>-16.7</td>
<td>-8.30</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-10</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>5.00</td>
<td>-7.8</td>
<td>-7.80</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-11</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>4.40</td>
<td>-7.8</td>
<td>1.10</td>
<td>0.0</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The last strategy we could try is interpolation with the <code>interpolate()</code> method. We specify the <code>method</code> parameter with the interpolation strategy to use. There are many options, but we will stick with the default of <code>'linear'</code>, which will treat values as evenly spaced and place missing values in the middle of existing ones. We have some missing data, so we will reindex first. Look at January 9th, which we didn’t have before—the values for <code>TMAX</code>, <code>TMIN</code>, and <code>TOBS</code> are the average of values the day prior (January 8th) and the day after (January 10th):</p>
<div id="cell-62" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>df_deduped<span class="op">\</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    .reindex(pd.date_range(<span class="st">'2018-01-01'</span>, <span class="st">'2018-12-31'</span>, freq<span class="op">=</span><span class="st">'D'</span>))<span class="op">\</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.interpolate())<span class="op">\</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">PRCP</th>
<th data-quarto-table-cell-role="th">SNOW</th>
<th data-quarto-table-cell-role="th">SNWD</th>
<th data-quarto-table-cell-role="th">TMAX</th>
<th data-quarto-table-cell-role="th">TMIN</th>
<th data-quarto-table-cell-role="th">TOBS</th>
<th data-quarto-table-cell-role="th">WESF</th>
<th data-quarto-table-cell-role="th">inclement_weather</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-01</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-02</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-8.3</td>
<td>-16.10</td>
<td>-12.20</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-03</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-4.4</td>
<td>-13.90</td>
<td>-13.30</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-04</td>
<td>20.6</td>
<td>229.0</td>
<td>inf</td>
<td>-4.4</td>
<td>-13.90</td>
<td>-13.60</td>
<td>19.3</td>
<td>True</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-05</td>
<td>14.2</td>
<td>127.0</td>
<td>inf</td>
<td>-4.4</td>
<td>-13.90</td>
<td>-13.90</td>
<td>0.0</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-06</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-10.0</td>
<td>-15.60</td>
<td>-15.00</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-07</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-11.7</td>
<td>-17.20</td>
<td>-16.10</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-08</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-7.8</td>
<td>-16.70</td>
<td>-8.30</td>
<td>0.0</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2018-01-09</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>-1.4</td>
<td>-12.25</td>
<td>-8.05</td>
<td>0.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-10</td>
<td>0.0</td>
<td>0.0</td>
<td>-inf</td>
<td>5.0</td>
<td>-7.80</td>
<td>-7.80</td>
<td>0.0</td>
<td>False</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>